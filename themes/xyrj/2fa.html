<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width,viewport-fit=cover">
    <title>{{ &title }}</title>
	<meta name="keywords" content="{{ &title }}" />
   	<meta name="keywords" content="{{ &OPT.siteKeywords }}" />
    <meta name="description" content="{{ &OPT.siteDescription }}" />
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}xyrj/files/fonts/fontawesome5pro-all.min.css'>
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}xyrj/files/style.css'>
    <link rel='stylesheet' href='{{ &OPT.theme_github_path }}xyrj/files/noto+serif.css' type='text/css' media='all' />
	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml">
	<link rel="shortcut icon" href="{{& OPT.theme_github_path}}xyrj/files/xyrj.png" type="image/x-icon">
	{{& OPT.codeBeforHead}}
    <style>
   /* --- START: Horizontal Tool Navigation Styles --- */
        /* 针对我们新添加的 .nav-tools-h 列表 */
        .nav-tools-h {
            display: flex;         /* 1. 使用 Flex 布局实现横向排列 */
            flex-wrap: wrap;       /* 2. 在小屏幕上允许换行 */
            list-style: none;      /* 3. 移除列表项的圆点 */
            padding: 0 0 10px 0;   /* 4. 底部留出内边距 */
            margin: 0 -5px 20px -5px; /* 5. 底部留出外边距，左右的负外边距用于对齐 */
            border-bottom: 1px solid #eee; /* 6. 添加底部分隔线，如图所示 */
        }
        .nav-tools-h .nav__item {
            margin: 5px 5px;       /* 7. 为每个菜单项添加一些间距 */
        }
        .nav-tools-h .nav__item a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: #555;
            border-radius: 4px;
            font-size: 14px;
        }
        /* 鼠标悬停效果 */
        .nav-tools-h .nav__item a:hover {
            background-color: #f5f5f5;
            color: #111;
        }
        /* 当前激活的菜单项样式 */
        .nav-tools-h .nav__item a.active {
            background-color: #eee;
            color: #111;
            font-weight: 600;
        }
        /* --- END: Horizontal Tool Navigation Styles --- */ 
		/* --- START: 2FA Verification Card Styles --- */
        /* 这个 wrapper 将用于在 xyrj-right 内部居中卡片 */
        .verification-card-wrapper {
            width: 100%;
            padding: 40px 15px; /* 添加一些垂直内边距 */
            box-sizing: border-box;
            display: flex;
            justify-content: center;
        }
        .verification-card {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            max-width: 350px; /* 卡片最大宽度 */
        }
        .verification-card h2 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: #333;
        }
        .verification-card input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            text-align: center;
            font-size: 1.2rem;
        }
        .verification-card button {
            width: 100%;
            padding: 0.75rem;
            background-color: #007bff; /* 图片中的蓝色 */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        .verification-card button:hover {
            background-color: #0056b3;
        }
        .verification-message {
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        .verification-message.error {
            color: red;
        }
        .verification-message.success {
            color: green;
        }
        /* --- END: 2FA Verification Card Styles --- */
    </style>
    </head>
<body class="m-flex"> 
	<header class="site-header">
    <div class="header-container">
        <div class="mobile-menu-toggle" id="mobile-menu-toggle">
            <i class="fal fa-bars"></i>
        </div>
        <div class="header-left">
            <div class="logo-area">
                {{ #OPT.logo }}
                <a href="/"><img src="{{ &OPT.logo }}" alt="博客Logo" class="logo-image"></a>
                {{ /OPT.logo }}
                {{ #OPT.showSiteNameInHeader }}
                <a href="/" class="blog-name">{{ &OPT.siteName }}</a>
                {{ /OPT.showSiteNameInHeader }}
            </div>
            <nav class="main-nav" id="main-nav">
                <div class="close-menu-btn" id="close-menu-btn">&times;</div>

                <div class="mobile-nav-header">
                    <img src="{{ &OPT.theme_github_path }}xyrj/files/mobile-header.svg" alt="导航背景" class="mobile-nav-header-image">
                </div>

                <ul>
                    {{ #OPT.widgetMenuList }}
                    <li>
                        <a href="{{ &url }}">
                            {{ #icon }}<i class="{{ &icon }}" style="margin-right: 5px;"></i> {{ /icon}}{{ &name }}
                            {{ #hasChildren }}
                            <span class="arrow-container"><i class="fal fa-angle-down"></i></span>
                            {{ /hasChildren }}
                        </a>
                        {{ #hasChildren }}
                        <span class="submenu-toggle"><i class="fal fa-angle-right"></i></span>
                        {{ /hasChildren }}

                        {{ #hasChildren }}
                        <ul class="sub-menu">
                            {{ #children }}
                            <li>
                                <a href="{{ &url }}">
                                    {{ #icon }}<i class="{{ &icon }}" style="margin-right: 5px;"></i> {{ /icon}}{{ &name }}
                                    {{ #hasChildren }}
                                    <span class="arrow-container"><i class="fal fa-angle-right"></i></span>
                                    {{ /hasChildren }}
                                </a>
                                {{ #hasChildren }}
                                <span class="submenu-toggle"><i class="fal fa-angle-right"></i></span>
                                {{ /hasChildren }}

                                {{ #hasChildren }}
                                <ul class="sub-menu">
                                    {{ #children }}
                                    <li>
                                        <a href="{{ &url }}">
                                            {{ #icon }}<i class="{{ &icon }}" style="margin-right: 5px;"></i> {{ /icon}}{{ &name }}
                                        </a>
                                    </li>
                                    {{ /children }}
                                </ul>
                                {{ /hasChildren }}
                            </li>
                            {{ /children }}
                        </ul>
                        {{ /hasChildren }}
                    </li>
                    {{ /OPT.widgetMenuList }}
                     <li class="login-btn-mobile">
                        <a href="/admin">
                            <button class="login-btn-header">登录</button>
                        </a>
                    </li>
                </ul>
            </nav>
            </div>

        <div class="header-right">
            <div class="search-icon" id="search-toggle">
                <i class="fal fa-search"></i>
            </div>
             <a href="/admin" class="login-link">
                <i class="fal fa-user-circle"></i>
            </a>
        </div>
    </div>

	<div class="search-box-container" id="search-box">
        <input type="text" placeholder="输入关键词搜索..." class="search-input">
        <button class="search-button">搜索</button>
        <i class="far fa-chevron-double-up" id="close-search-btn" title="收起"></i>
    </div>
</header>
    <div id="wrap" class="container">
		<div class="main-layout">
					<aside id="desktop-sidebar-wrapper" class="xyrj-left">
							<div class="sidebar-inner-wrapper">
								<div class="box box-content">
									<ul class="nav-tools-h">
										<li class="nav__item"><a class="active" href="https://2fa.run"><i class="icon-key"></i>2FA工具</a></li>
										<li class="nav__item"><a href="note.html"><i class="icon-clipboard"></i>文本处理</a></li>
										<li class="nav__item"><a href="work.html"><i class="icon-instagram1"></i>图片处理</a></li>
										<li class="nav__item"><a href="money.html"><i class="icon-activity"></i>汇率换算</a></li>
										<li class="nav__item"><a href="more.html"><i class="icon-more-horizontal"></i>更多工具</a></li>
									</ul>
								</div>
							</div>
					</aside>

					<div class="xyrj-right">
						<div class="verification-card-wrapper">
							<div class="verification-card">
								<h2>2FA Verification</h2>
								<input type="text" id="token-input" placeholder="Enter 2FA Token" autocomplete="off" onkeyup="enterSubmit(event)">
								<button id="verify-button" onclick="verifyToken()">Submit</button>
								<p id="message-output" class="verification-message"></p>
							</div>
						</div>
					</div>				
		</div>
        <div class="friend-links">
             <h3 class="widget-title">友情链接</h3>
             <div class="links-container">
                {{#widgetLinkList}}
                <div class="link-item">
                    {{#img}}
                        <a href="{{url}}" target="_blank" title="{{name}}">
                            <img src="{{img}}" alt="{{name}}">
                        </a>
                    {{/img}}
                    {{^img}}
                        <a href="{{url}}" target="_blank">{{name}}</a>
                    {{/img}}
                </div>
                {{/widgetLinkList}}
            </div>
        </div>
    </div>

	<footer class="footer">
		<div class="container">
			<div class="footer-meta">
				<div class="footer-links">
					{{{ footer_links }}}
				</div>
				<p>{{{ site_footer_copyright }}}</p>
			</div>
			</div>
	</footer>

    <div class="action action-style-0 action-color-0 action-pos-0">
        <div class="action-item gotop j-top">
            <i class="fal fa-arrow-up action-item-icon"></i>
        </div>
    </div>
    
    <script src="{{ &OPT.theme_github_path }}xyrj/tools/otpauth.umd.min.js"></script>
	<script src="{{ &OPT.theme_github_path }}xyrj/tools/qrcode.min.js"></script>
	<script src="{{ &OPT.theme_github_path }}xyrj/files/sticky-sidebar.min.js"></script>
	<script>
window.addEventListener('load', function() {
    const sidebarElement = document.querySelector('#desktop-sidebar-wrapper');
    
    if (window.innerWidth >= 992 && sidebarElement) {
        // Check if the sidebar is already initialized and destroy it before re-initializing
        if (this.state && this.state.desktopSidebar) {
            this.state.desktopSidebar.destroy();
        }

        // Initialize StickySidebar
        this.state = this.state || {}; // Ensure 'this.state' is defined
        this.state.desktopSidebar = new StickySidebar('#desktop-sidebar-wrapper', {
            topSpacing: 80,
            bottomSpacing: 20,
            containerSelector: '.main-layout',
            innerWrapperSelector: '.sidebar-inner-wrapper'
        });
    }
});
	</script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const topButton = document.querySelector('.j-top');
            if(topButton) {
                topButton.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
        });
    </script>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchToggle = document.getElementById('search-toggle');
            const searchBox = document.getElementById('search-box');
            const closeSearchBtn = document.getElementById('close-search-btn');

            if (searchToggle && searchBox) {
                searchToggle.addEventListener('click', function(event) {
                    event.stopPropagation();
                    searchBox.classList.toggle('visible');
                });
                
                searchBox.addEventListener('click', function(event) {
                    event.stopPropagation();
                });
            }

            if (closeSearchBtn) {
                closeSearchBtn.addEventListener('click', function() {
                    searchBox.classList.remove('visible');
                });
            }
            
            document.addEventListener('click', function() {
                if (searchBox && searchBox.classList.contains('visible')) {
                    searchBox.classList.remove('visible');
                }
            });

            const menuToggle = document.getElementById('mobile-menu-toggle');
            const mainNav = document.getElementById('main-nav');
            const body = document.querySelector('body');
            const overlay = document.getElementById('overlay');
            const closeMenuBtn = document.getElementById('close-menu-btn');

            const openMenu = function() { body.classList.add('nav-open'); };
            const closeMenu = function() { body.classList.remove('nav-open'); };
            
            if (menuToggle) { menuToggle.addEventListener('click', function(event) { event.stopPropagation(); openMenu(); }); }
            if (overlay) { overlay.addEventListener('click', closeMenu); }
            if (closeMenuBtn) { closeMenuBtn.addEventListener('click', closeMenu); }
            mainNav.addEventListener('click', function(event){ event.stopPropagation(); });

            const submenuToggles = document.querySelectorAll('.main-nav .submenu-toggle');
            submenuToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const subMenu = this.nextElementSibling;
                    if (subMenu && subMenu.classList.contains('sub-menu')) {
                        subMenu.classList.toggle('open');
                    }
                });
            });
            
            // --- START: 在这里添加搜索按钮的 JS 逻辑 ---
            const searchButton = document.querySelector('.search-button');
            const searchInput = document.querySelector('.search-input');

            if(searchButton && searchInput) {
                const performSearch = () => {
                    const query = searchInput.value.trim();
                    if (query) {
                        // 重定向到搜索结果页 (这个 URL 稍后需要在 index_plus.js 中实现)
                        window.location.href = '/search/' + encodeURIComponent(query) + '/';
                    }
                };

                // 点击按钮时搜索
                searchButton.addEventListener('click', performSearch);

                // 在输入框按回车键时搜索
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
            // --- END: 搜索按钮的 JS 逻辑 ---
            // --- END: Cleaned Comment Logic ---
			// --- START: 2FA Verification Logic ---
        function showMessage(msg, isError = false) {
            const messageEl = document.getElementById('message-output');
            if (messageEl) {
                messageEl.textContent = msg;
                messageEl.className = isError ? 'verification-message error' : 'verification-message success';
            }
        }

        // 允许回车键提交
        function enterSubmit(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                verifyToken();
            }
        }

        async function verifyToken() {
            const tokenInput = document.getElementById('token-input');
            const token = tokenInput.value.trim();
            
            if (!token) {
                showMessage('Please enter a token.', true);
                return;
            }

            const button = document.getElementById('verify-button');
            button.disabled = true;
            button.textContent = 'Verifying...';

            try {
                // 假设你的 worker.js 中有一个 /admin/2fa-verify 路由用于验证
                // 你需要根据 worker.js 的实际设置修改这个 URL
                const response = await fetch('/admin/2fa-verify', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: token })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showMessage('Verification successful! Redirecting...', false);
                    // 验证成功后，worker 应该已经设置了最终的 auth cookie
                    // 我们重定向到 admin 页面
                    window.location.href = result.redirect || '/admin';
                } else {
                    throw new Error(result.message || 'Invalid token.');
                }

            } catch (err) {
                console.error('Verification error:', err);
                showMessage(err.message || 'Invalid token. Please try again.', true);
                button.disabled = false;
                button.textContent = 'Submit';
                tokenInput.value = ''; // 清空输入
            }
        }
        // --- END: 2FA Verification Logic ---
        });
    </script>
	<div id="copy-notification">已复制!</div>
</body>
</html>
